<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>File Upload Form</title>
</head>
<body>
	<h1>File List</h1>
	<button id="listButton" onclick="listFiles()">List Files</button>
	<div id="fileList"></div>

	<h1>File Upload Form</h1>
	
	<form id="uploadForm" action="/" method="post" enctype="multipart/form-data">
		<label for="file">Select a file:</label>
		<input type="file" name="file" id="file" required>
		<br>
		<input type="button" value="Upload" onclick="uploadFile()">
	</form>

	<script>
		var isListDisplayed = false;
		function listFiles() {
			if (isListDisplayed) {
				// If list is displayed, hide it and update the button text
				document.getElementById("fileList").innerHTML = "";
				document.getElementById("listButton").innerText = "List Files";
				isListDisplayed = false;
			} else {
				// Make an AJAX request to fetch the file history from the server
				var xhr = new XMLHttpRequest();
				xhr.onreadystatechange = function () {
					if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
						// Display the file history in the result div
						document.getElementById("fileList").innerHTML = xhr.responseText;
						document.getElementById("listButton").innerText = "Hide List";
						isListDisplayed = true;
					}
				};
				xhr.open("GET", "list_files.php", true);
				xhr.send();
			}
		}
		function uploadFile() {
			// Get the file input element
			var fileInput = document.getElementById('file');
			
			// Check if a file is selected
			if (fileInput.files.length > 0) {
				// Create a new XMLHttpRequest object
				var xhr = new XMLHttpRequest();
				//xhr.setRequestHeader('Content-Type', 'undefined');
				
				// Configure it for a POST request to the dynamic host and port
				var host = window.location.hostname; // Get the current hostname dynamically
				var port = window.location.port; // Get the current port dynamically
				xhr.open('POST', 'http://' + host + ':' + port + '/uploads/', true);
				console.log(host, port);
				// Define a callback function to handle the response
				xhr.onload = function() {
					if (xhr.status === 201 || xhr.status == 200) {
						alert('File uploaded successfully!');
					} else {
						// Display the HTML response from the server in the current window
						console.log(xhr.responseText);
						document.open(); // Open a new document
						document.write(xhr.responseText); // Write the HTML response to the document
						document.close(); // Close the document
					}
				};

				// Create a FormData object
				var formData = new FormData();
				
				// Append the file to the FormData object
				formData.append('file', fileInput.files[0]);

				// Send the FormData object containing the file
				xhr.send(formData);
			} else {
				alert('Please select a file before uploading.');
			}
		}
	</script>
	<a href="./index.html">Back to Home</a>
</body>
</html>
